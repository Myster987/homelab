---
apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
    name: cloudflare-tunnel-remote
    namespace: cloudflare
spec:
    interval: 30m
    chart:
        spec:
            chart: cloudflared
            version: ">= 2.2.0"
            sourceRef:
                kind: HelmRepository
                name: cloudflare-tunnel-remote
                namespace: cloudflare
            interval: 2h
    values:
        tunnelConfig:
            name: homelab-cluster-tunnel
        tunnelSecrets:
            existingConfigJsonFileSecret:
                name: config-json-file-secret
            existingPemFileSecret:
                name: cert-pem-file-secret
        ingress:
            - hostname: "*.mikolajmaciejak.dev"
              service: https://envoy-edge.envoy-gateway.svc.cluster.local:80
            - service: http_status:404
